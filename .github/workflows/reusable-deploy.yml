name: Reusable – Deploy to AWS

on:
  workflow_call:
    inputs:
      environment:
        description: "Target deployment environment (e.g. staging, production)"
        required: true
        type: string
      aws_region:
        description: "AWS region to deploy to"
        required: true
        type: string
    secrets:
      aws_role_to_assume:
        description: "ARN of the IAM role to assume via OIDC"
        required: true

permissions:
  contents: read
  id-token: write

jobs:
  deploy:
    name: Deploy – ${{ inputs.environment }}
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    steps:
      - name: Checkout source
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: Download backend artifact
        uses: actions/download-artifact@95815c38cf2ff2164869cbab79da8d1f422bc89e # v4.2.1
        with:
          name: backend-jar
          path: backend/target/

      - name: Download frontend artifact
        uses: actions/download-artifact@95815c38cf2ff2164869cbab79da8d1f422bc89e # v4.2.1
        with:
          name: frontend-dist
          path: frontend/dist/

      - name: Configure AWS credentials (OIDC)
        uses: aws-actions/configure-aws-credentials@e3dd6a429d7300a6a4c196c26e071d42e0343502 # v4.0.2
        with:
          role-to-assume: ${{ secrets.aws_role_to_assume }}
          aws-region: ${{ inputs.aws_region }}

      # Placeholder – replace with your actual deploy steps
      - name: Deploy (placeholder)
        run: echo "Deploying to ${{ inputs.environment }} in ${{ inputs.aws_region }}…"
